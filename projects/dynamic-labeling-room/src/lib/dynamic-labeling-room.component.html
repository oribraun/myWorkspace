<div class="dynamic-labeling-room" #dynamic_labeling_room
     *ngIf="data && blocks"
     [ngStyle]="mainCssObj">
    <div class="view"
         [ngClass]="{'view-with-url': data.url, 'dynamic-labeling-room-animated-all': resetViewAnimate}"
         [ngStyle]="{
            'height': (currentDrag.view.height !== '' ? currentDrag.view.height + '%' : ''),
            'top': currentDrag.view.top + '%',
            'bottom': currentDrag.view.bottom + '%',
            'left': currentDrag.view.left + '%',
            'right': currentDrag.view.right + '%'
            }">
        <div class="view-text"
             [style]="!data.url ? viewCssObj : ''"
             *ngIf="!data.url && data.text"><span #viewText>{{data.text}}</span></div>
        <!--        <div *ngIf="show.url"><a [href]="show.url" target="_blank">{{show.url}}</a></div>-->
        <div class="iframe-wrapper" *ngIf="data.url">
            <ng-container *ngIf="data.showInIframe">
                <div class="iframe-loader-wrapper" *ngIf="iframeLoading">
                    <div class="iframe-loader"><div></div><div></div><div></div><div></div></div>
                </div>
                <iframe [ngClass]="{'dragging': dragStarted}" #iframe [src]="data.url | safe"></iframe>
            </ng-container>
            <ng-container *ngIf="!data.showInIframe">
                <a #urlText [href]="data.url" target="_blank">{{data.url}}</a>
            </ng-container>
        </div>
        <div class="horizontal-drag horizontal-drag-bottom"
             *ngIf="currentDrag.view.onMove.bottom"
             (mousedown)="onMouseDown($event, 'view', 'top, bottom')"
             (touchstart)="onMouseDown($event, 'view', 'top, bottom')"></div>
        <div class="vertical-drag vertical-drag-right"
             *ngIf="currentDrag.view.onMove.left"
             (mousedown)="onMouseDown($event, 'view', 'left, right')"
             (touchstart)="onMouseDown($event, 'view', 'left, right')"></div>
    </div>
    <form #form="ngForm">
        <div class="labeling"
             [ngClass]="{'dynamic-labeling-room-animated-all': resetViewAnimate}"
             [ngStyle]="{
                'height': (currentDrag.labeling.height !== '' ? currentDrag.labeling.height + '%' : ''),
                'top': currentDrag.labeling.top + '%',
                'bottom': currentDrag.labeling.bottom + '%',
                'left': currentDrag.labeling.left + '%',
                'right': currentDrag.labeling.right + '%'
                }">
            <div class="horizontal-drag horizontal-drag-top"
                 *ngIf="currentDrag.labeling.onMove.top"
                 (mousedown)="onMouseDown($event, 'labeling', 'top, bottom')"
                 (touchstart)="onMouseDown($event, 'labeling', 'top, bottom')"></div>
            <div class="vertical-drag vertical-drag-left"
                 *ngIf="currentDrag.labeling.onMove.right"
                 (mousedown)="onMouseDown($event, 'labeling', 'left, right')"
                 (touchstart)="onMouseDown($event, 'labeling', 'left, right')"></div>
            <div class="labeling-overflow"
                 [style]="formCssObj">
                <div class="labeling-header" #labelingHeader *ngIf="data.isList" [ngClass]="{'labeling-header-fixed': data.isList && data.listHeaderFixed}">
                    {{data.listHeader}} <span class="labeling-header-plus no-highlight"
                                              (click)="addToMainList(listBlocks)">+</span>
                    <br>
                    <div class="labeling-header-item no-highlight" *ngFor="let item of mainList; let i = index"
                         (click)="selectMainItem(i)"
                         [ngClass]="{'labeling-header-item-selected': listCurrentIndex === i, 'labeling-header-item-invalid': mainList[i].isValid !== undefined && !mainList[i].isValid}">
                        {{getMainObjHeader(i)}} <span *ngIf="mainList.length > 1" class="labeling-header-item-minus no-highlight" (click)="removeFromMainList(i)">x</span>

                    </div>
                </div>
                <div class="labeling-body" #labelingBody [ngClass]="{'labeling-block-fixed': data.isList && data.listHeaderFixed}">
                    <ng-container *ngFor="let block of blocks">
                        <div class="labeling-block" [ngClass]="{
                        'labeling-block-inline': block.blockWidth
                        }" [ngStyle]="block.blockWidth && {'width':block.blockWidth + '%'}">
                            <div class="labeling-block-row">
                                <div class="labeling-block-row-column">
                                    <div class="labeling-block-row-column-header">
                                        {{preetyLabel(block.blockName)}}
                                        <div class="labeling-block-row-column-header-description">
                                            {{block.blockDesc}}
                                        </div>
                                    </div>
                                    <div class="labeling-block-row-column-body">
                                        <div class="labeling-block-row-column-body-item labeling-block-row-column-body-item-col
                                labeling-block-row-column-body-item-{{item.inputType}}"
                                             *ngFor="let item of block.fields"
                                             [ngStyle]="{
                                    'flex': '0 0 ' + (10/block.numColumns*10) + '%',
                                    'max-width': (10/block.numColumns*10) + '%'
                                   }"
                                             [ngClass]="{
                                 'labeling-block-row-column-body-item-box-break-line': item.breakLine,
                                 'labeling-block-row-column-body-item-box-full-line': item.fullLine,
                                 'labeling-block-row-column-body-item-box-center': item.center
                                 }">
                                            <div class="labeling-block-row-column-body-item-box">
                                                <div class="labeling-block-row-column-body-item-box-input">
                                                    <input *ngIf="item.inputType === 'text' || item.inputType === 'number' || item.inputType === 'email'"
                                                           [type]="item.inputType"
                                                           [ngStyle]="item.css"
                                                           [name]="block.blockName + '_' + item.label"
                                                           [required]="item.required"
                                                           [pattern]="item.pattern"
                                                           [(ngModel)]="item.value"
                                                           (ngModelChange)="onChangeBlocks()"
                                                           [attr.value]="item.value"
                                                           [ngClass]="{
                                                           'required': formSubmitted &&
                                                           form.controls[item.label] &&
                                                           form.controls[item.label].errors &&
                                                           (form.controls[item.label].errors.required || form.controls[item.label].errors.pattern)
                                                       }"
                                                           [disabled]="checkDepend(block.fields, item)">
                                                    <input *ngIf="item.inputType === 'checkbox'"
                                                           [type]="item.inputType"
                                                           [checked]="item.value == 1"
                                                           [ngStyle]="item.css"
                                                           [name]="item.label"
                                                           [required]="item.required"
                                                           [ngClass]="{
                                                           'required': formSubmitted &&
                                                           form.controls[item.label] &&
                                                           form.controls[item.label].errors &&
                                                           (form.controls[item.label].errors.required)
                                                       }"
                                                           (change)="!item.value ? item.value = 1 : item.value = 0; onChangeBlocks()">
                                                    <textarea *ngIf="item.inputType === 'textarea'"
                                                              [ngStyle]="item.css"
                                                              [name]="item.label"
                                                              [required]="item.required"
                                                              [(ngModel)]="item.value"
                                                              (ngModelChange)="onChangeBlocks()"
                                                              [attr.value]="item.value"
                                                              [ngClass]="{
                                                              'required': formSubmitted &&
                                                              form.controls[item.label] &&
                                                              form.controls[item.label].errors &&
                                                              (form.controls[item.label].errors.required)
                                                          }"
                                                              [disabled]="checkDepend(block.fields, item)">
                                                </textarea>
                                                    <select name="" [attr.test]="item.value" *ngIf="item.inputType === 'select'"
                                                            [ngStyle]="item.css"
                                                            [name]="item.label"
                                                            [required]="item.required"
                                                            (change)="item.value = $event.target.value; onChangeBlocks()"
                                                            [disabled]="checkDepend(block.fields, item)"
                                                            [attr.value]="item.value"
                                                            [ngClass]="{
                                                           'required': formSubmitted &&
                                                           form.controls[item.label] &&
                                                           form.controls[item.label].errors &&
                                                           (form.controls[item.label].errors.required)
                                                       }">
                                                        <option value="" [selected]="!item.value"></option>
                                                        <option *ngFor="let o of item.options" [selected]="item.value == o" [value]="o">{{o}}</option>
                                                    </select>
                                                    <div class="labeling-block-row-column-body-item-box-input-label"
                                                         [ngClass]="{'labeling-block-row-column-body-item-box-input-label-hover':
                                                     item.inputType === 'text' ||
                                                     item.inputType === 'number' ||
                                                     item.inputType === 'email' ||
                                                     item.inputType === 'textarea' ||
                                                     item.inputType === 'select',
                                                     'labeling-block-row-column-body-item-box-input-label-hover-disappeared': true
                                                     }">
                                                        <div class="labeling-block-row-column-body-item-box-input-label-text"
                                                             *ngIf="item.inputType !== 'radio'">
                                                            {{preetyLabel(item.label)}}
                                                            <span *ngIf="item.inputType === 'text_list'" class="labeling-block-row-column-body-item-box-input-label-plus no-highlight"
                                                                  (click)="appendItemToList(item)">+</span>
                                                        </div>
                                                    </div>
                                                    <ng-container *ngIf="item.inputType === 'select_multiple'">
                                                        <select name="" *ngIf="item.inputType === 'select_multiple'"
                                                                multiple
                                                                [ngStyle]="item.css"
                                                                [name]="item.label"
                                                                [required]="item.required"
                                                                [(ngModel)]="item.value"
                                                                (ngModelChange)="onChangeBlocks()"
                                                                [disabled]="checkDepend(block.fields, item)"
                                                                [attr.value]="item.value"
                                                                [ngClass]="{
                                                           'required': formSubmitted &&
                                                           form.controls[item.label] &&
                                                           form.controls[item.label].errors &&
                                                           (form.controls[item.label].errors.required)
                                                       }">
                                                            <option *ngFor="let o of item.options" [selected]="item.value == o" [value]="o">{{o}}</option>
                                                        </select>
                                                    </ng-container>
                                                    <div class="radio-buttons"
                                                         [ngClass]="{'radio-buttons-center': item.center}"
                                                         *ngIf="item.inputType === 'radio'">
                                                        <ng-container *ngFor="let o of item.options">
                                                            <label class="radio-label" [htmlFor]="o">
                                                                <input
                                                                    [id]="o"
                                                                    [type]="item.inputType"
                                                                    [checked]="item.value == o"
                                                                    (change)="item.value = o; onChangeBlocks()"
                                                                    [ngStyle]="item.css"
                                                                    [name]="item.label"
                                                                    [attr.name]="item.label"
                                                                    [required]="item.required"
                                                                    [ngClass]="{
                                                                   'required': formSubmitted &&
                                                                   form.controls[item.label] &&
                                                                   form.controls[item.label].errors &&
                                                                   (form.controls[item.label].errors.required)
                                                                }">
                                                                {{o}}</label>
                                                        </ng-container>
                                                    </div>
                                                    <ng-container *ngIf="item.inputType === 'text_list' && isArray(item.value)">
                                                        <div class="labeling-block-row-column-body-item-box-input-description" *ngIf="item.description">
                                                            {{item.description}}
                                                        </div>
                                                        <div class="labeling-block-row-column-body-item-box-input-list-item" *ngFor="let listItem of item.value; index as i; trackBy: trackByFn">
                                                            <ng-container *ngIf="!item.listBlocks">
                                                                <input [type]="item.inputType"
                                                                       [name]="item.label + '-' + i"
                                                                       [required]="item.required"
                                                                       [pattern]="item.pattern"
                                                                       [(ngModel)]="item.value[i]"
                                                                       [ngClass]="{
                                                                       'required': formSubmitted &&
                                                                       form.controls[item.label + '-' + i] &&
                                                                       form.controls[item.label + '-' + i].errors &&
                                                                       (form.controls[item.label + '-' + i].errors.required)
                                                                   }"
                                                                       (ngModelChange)="onChangeBlocks()">
                                                                <div class="labeling-block-row-column-body-item-box-input-list-item-minus no-highlight" (click)="removeItemToList(item, i); onChangeBlocks();">-</div>
                                                            </ng-container>
                                                            <ng-container *ngIf="item.listBlocks">
                                                                <div class="labeling-block-row-column-body-item-box-input-list-item-wrapper"
                                                                     [ngStyle]="{'width': (10 / getObjKeysLength(item.listBlocks) * 10 - 2) + '%'}"
                                                                     *ngFor="let objItem of item.value[i]; index as j;let last = last;">
                                                                    <input [type]="objItem.inputType"
                                                                           [name]="item.label + '-' + objItem.label + '-' + i + '-' + j"
                                                                           [required]="objItem.required"
                                                                           [(ngModel)]="objItem.value"
                                                                           [attr.value]="objItem.value"
                                                                           [ngClass]="{
                                                                           'required': formSubmitted &&
                                                                           form.controls[item.label + '-' + objItem.label + '-' + i + '-' + j] &&
                                                                           form.controls[item.label + '-' + objItem.label + '-' + i + '-' + j].errors &&
                                                                           (form.controls[item.label + '-' + objItem.label + '-' + i + '-' + j].errors.required)
                                                                       }"
                                                                           (ngModelChange)="onChangeBlocks()">
                                                                    <div class="labeling-block-row-column-body-item-box-input-list-item-label"
                                                                         [ngClass]="{
                                                                        'labeling-block-row-column-body-item-box-input-list-item-label-hover': true,
                                                                        'labeling-block-row-column-body-item-box-input-list-item-label-hover-disappeared': true
                                                                     }">
                                                                        <div class="labeling-block-row-column-body-item-box-input-list-item-label-text">
                                                                            {{preetyLabel(objItem.label)}}
                                                                        </div>
                                                                    </div>
                                                                    <div class="labeling-block-row-column-body-item-box-input-list-item-minus no-highlight"
                                                                         *ngIf="last"
                                                                         (click)="removeItemToList(item, i); onChangeBlocks();">-</div>

                                                                </div>
                                                            </ng-container>
                                                        </div>
                                                    </ng-container>
                                                </div>
                                                <small class="labeling-block-row-column-body-item-box-input-description" *ngIf="item.description && item.inputType !== 'text_list'">
                                                    {{item.description}}
                                                </small>
                                            </div>
                                            <!--                        <div class="labeling-block-row-column-body-item-box-break-line" *ngIf="item.break_line"></div>-->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </ng-container>
                    <div class="blocksErrMessage text-center" *ngIf="blocksErrMessage">
                        {{blocksErrMessage}}
                    </div>
                </div>
            </div>
        </div>
    </form>
    <!--    <div class="floating-template-button"-->
    <!--         [ngClass]="{'floating-template-button-vertical': templateType === 2}"-->
    <!--         (click)="changeTemplateType()">-->
    <!--        <div class="lds-hourglass"-->
    <!--             [title]="templateType === 1 ? 'vertical' : 'horizontal'"-->
    <!--        [ngClass]="{'animate': changeTemplateAnimation}"></div>-->
    <!--    </div>-->
    <div class="menu" [ngClass]="{'menu-hover-animate': animateMenu}">
        <div class="inner-menu">
            <i class="d-icon-sync" title="change template" (click)="changeTemplateType()" [ngClass]="{'d-icon-animate': changeTemplateAnimation}"></i>
            <!--      <i class="d-icon-reset" [ngClass]="{'d-icon-animate': false}"></i>-->
            <i class="d-icon-expend" title="full screen" (click)="expand()" [ngClass]="{'d-icon-animate': false}"><span class="line"></span></i>
        </div>
    </div>
</div>
